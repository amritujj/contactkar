<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vehicle Tags - ContactKar</title>
    <link rel="stylesheet" href="styles_v2.css">
</head>


<!-- ====== PRICING SECTION ====== -->
<section id="pricing" style="padding:4rem 0; background:#f8faff;">
  <div class="container">
    <h2 style="text-align:center; margin-bottom:0.5rem;">Choose Your Plan</h2>
    <p style="text-align:center; color:#6b7280; margin-bottom:2rem;">All plans include a Soft Copy QR Code. Hard copy delivery available as add-on.</p>

    <div class="pricing-grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:20px; max-width:900px; margin:0 auto;">
      <!-- Basic -->
      <div class="tier-card" style="border:2px solid #e5e7eb; border-radius:12px; padding:24px; text-align:center; background:white;">
        <h3 style="margin:0 0 8px;">Basic</h3>
        <p style="color:#6b7280; font-size:14px; margin-bottom:16px;">1 Vehicle Tag</p>
        <div style="font-size:14px; color:#9ca3af; text-decoration:line-through;">‚Çπ99/year</div>
        <div style="font-size:36px; font-weight:800; color:#111827; margin:4px 0;">‚Çπ0</div>
        <div style="font-size:12px; font-weight:bold; color:red; margin-bottom:16px;">TESTING MODE - FREE</div>
        <ul style="list-style:none; padding:0; text-align:left; margin-bottom:20px;">
          <li style="margin-bottom:8px;">‚úÖ 1 Vehicle Tag</li>
          <li style="margin-bottom:8px;">‚úÖ Voice Call Alerts</li>
          <li style="margin-bottom:8px;">‚úÖ 1 Emergency Contact</li>
          <li style="margin-bottom:8px;">‚úÖ Soft Copy QR Code</li>
        </ul>
        <button class="btn btn-primary" style="width:100%;" onclick="openSetupModal('basic')">Get Basic Free</button>
      </div>

      <!-- Plus -->
      <div class="tier-card" style="border:2px solid #2563eb; border-radius:12px; padding:24px; text-align:center; background:white; position:relative;">
        <div style="position:absolute; top:-12px; left:50%; transform:translateX(-50%); background:#2563eb; color:white; padding:4px 14px; border-radius:20px; font-size:12px; font-weight:bold; white-space:nowrap;">MOST POPULAR</div>
        <h3 style="margin:0 0 8px;">Plus</h3>
        <p style="color:#6b7280; font-size:14px; margin-bottom:16px;">Up to 3 Tags</p>
        <div style="font-size:14px; color:#9ca3af; text-decoration:line-through;">‚Çπ249/year</div>
        <div style="font-size:36px; font-weight:800; color:#111827; margin:4px 0;">‚Çπ0</div>
        <div style="font-size:12px; font-weight:bold; color:red; margin-bottom:16px;">TESTING MODE - FREE</div>
        <ul style="list-style:none; padding:0; text-align:left; margin-bottom:20px;">
          <li style="margin-bottom:8px;">‚úÖ Up to 3 Tags</li>
          <li style="margin-bottom:8px;">‚úÖ WhatsApp + SMS Alerts</li>
          <li style="margin-bottom:8px;">‚úÖ 2 Emergency Contacts</li>
          <li style="margin-bottom:8px;">‚úÖ Custom Scan Page Colors</li>
        </ul>
        <button class="btn btn-primary" style="width:100%;" onclick="openSetupModal('plus')">Get Plus Free</button>
      </div>

      <!-- Pro -->
      <div class="tier-card" style="border:2px solid #e5e7eb; border-radius:12px; padding:24px; text-align:center; background:white;">
        <h3 style="margin:0 0 8px;">Pro</h3>
        <p style="color:#6b7280; font-size:14px; margin-bottom:16px;">Up to 5 Tags</p>
        <div style="font-size:14px; color:#9ca3af; text-decoration:line-through;">‚Çπ499/year</div>
        <div style="font-size:36px; font-weight:800; color:#111827; margin:4px 0;">‚Çπ0</div>
        <div style="font-size:12px; font-weight:bold; color:red; margin-bottom:16px;">TESTING MODE - FREE</div>
        <ul style="list-style:none; padding:0; text-align:left; margin-bottom:20px;">
          <li style="margin-bottom:8px;">‚úÖ Up to 5 Tags</li>
          <li style="margin-bottom:8px;">‚úÖ Video Call Alerts</li>
          <li style="margin-bottom:8px;">‚úÖ 3 Emergency Contacts</li>
          <li style="margin-bottom:8px;">‚úÖ Priority Support</li>
        </ul>
        <button class="btn btn-primary" style="width:100%;" onclick="openSetupModal('pro')">Get Pro Free</button>
      </div>
    </div>
  </div>
</section>

<!-- ====== SETUP MODAL ====== -->
<div id="setupModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.55); z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:32px; border-radius:16px; width:90%; max-width:420px; box-shadow:0 20px 40px rgba(0,0,0,0.2); animation:fadeInUp 0.3s ease;">
    <h3 style="margin:0 0 8px; color:#111827; font-size:1.3rem;">üöó Setup Your Vehicle Tag</h3>
    <p style="color:#6b7280; font-size:14px; margin-bottom:20px;">Fill in your details. Your QR code will be generated instantly.</p>

    <div style="margin-bottom:14px;">
      <label style="display:block; font-weight:600; font-size:14px; margin-bottom:5px; color:#374151;">Vehicle Number *</label>
      <input id="vehNumber" type="text" placeholder="e.g. DL-01-AB-1234" style="width:100%; padding:10px; border:1.5px solid #d1d5db; border-radius:8px; font-size:15px; text-transform:uppercase;">
    </div>

    <div style="margin-bottom:14px;">
      <label style="display:block; font-weight:600; font-size:14px; margin-bottom:5px; color:#374151;">Vehicle Type *</label>
      <select id="vehType" style="width:100%; padding:10px; border:1.5px solid #d1d5db; border-radius:8px; font-size:15px;">
        <option value="Car">üöó Car</option>
        <option value="Bike">üèçÔ∏è Bike / Scooter</option>
        <option value="Commercial">üöõ Commercial Vehicle</option>
        <option value="Truck">üöö Truck / Tempo</option>
      </select>
    </div>

    <div style="margin-bottom:14px;">
      <label style="display:block; font-weight:600; font-size:14px; margin-bottom:5px; color:#374151;">Owner / Contact Name *</label>
      <input id="vehOwner" type="text" placeholder="Name shown on scan page" style="width:100%; padding:10px; border:1.5px solid #d1d5db; border-radius:8px; font-size:15px;">
    </div>

    <div style="margin-bottom:14px;">
      <label style="display:block; font-weight:600; font-size:14px; margin-bottom:5px; color:#374151;">Emergency Contact Number *</label>
      <input id="vehEmergency" type="tel" placeholder="+91 98765 43210" style="width:100%; padding:10px; border:1.5px solid #d1d5db; border-radius:8px; font-size:15px;">
    </div>

    <div style="margin-bottom:20px;">
      <label style="display:block; font-weight:600; font-size:14px; margin-bottom:5px; color:#374151;">Tag Delivery</label>
      <select id="vehDelivery" style="width:100%; padding:10px; border:1.5px solid #d1d5db; border-radius:8px; font-size:15px;">
        <option value="soft">üìÑ Soft Copy (Free - Print at Home)</option>
        <option value="hard">üì¶ Hard Copy PVC Sticker (+‚Çπ149)</option>
      </select>
    </div>

    <div id="modalError" style="display:none; background:#fef2f2; color:#dc2626; padding:10px; border-radius:8px; font-size:14px; margin-bottom:14px;"></div>

    <div style="display:flex; gap:10px;">
      <button onclick="closeSetupModal()" style="flex:1; padding:12px; border:1.5px solid #d1d5db; border-radius:8px; background:white; color:#374151; font-weight:600; cursor:pointer;">Cancel</button>
      <button id="btnGenerate" onclick="submitTagSetup()" style="flex:1; padding:12px; border:none; border-radius:8px; background:#2563eb; color:white; font-weight:700; cursor:pointer; font-size:15px;">Generate QR ‚ú®</button>
    </div>
  </div>
</div>

<!-- ====== SCRIPTS ====== -->
<script>
  const API_URL = 'https://contactkar.onrender.com/api';
  let selectedTier = '';

  function openSetupModal(tier) {
    const token = localStorage.getItem('token');
    if (!token) {
      alert("Please login first!");
      window.location.href = 'login.html';
      return;
    }
    selectedTier = tier;
    const userName = localStorage.getItem('userName');
    if (userName) document.getElementById('vehOwner').value = userName;
    document.getElementById('setupModal').style.display = 'flex';
    document.getElementById('modalError').style.display = 'none';
  }

  function closeSetupModal() {
    document.getElementById('setupModal').style.display = 'none';
  }

  async function submitTagSetup() {
    const vehNumber   = document.getElementById('vehNumber').value.trim().toUpperCase();
    const vehType     = document.getElementById('vehType').value;
    const vehOwner    = document.getElementById('vehOwner').value.trim();
    const vehEmergency = document.getElementById('vehEmergency').value.trim();
    const delivery    = document.getElementById('vehDelivery').value;
    const errBox      = document.getElementById('modalError');

    if (!vehNumber || !vehOwner || !vehEmergency) {
      errBox.style.display = 'block';
      errBox.innerText = '‚ö†Ô∏è Please fill in all required fields.';
      return;
    }

    const btn = document.getElementById('btnGenerate');
    btn.innerText = 'Generating...';
    btn.disabled = true;
    errBox.style.display = 'none';

    try {
      const token = localStorage.getItem('token');

      // Step 1: Upgrade/assign subscription
      await fetch(`${API_URL}/billing/upgrade`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify({ tier: selectedTier })
      });

      // Step 2: Create the tag with vehicle details
      const orderRes = await fetch(`${API_URL}/orders/place`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify({
          vehicleQty: 1,
          petQty: 0,
          address: delivery === 'soft' ? 'Soft Copy' : 'Hard Copy',
          city: 'N/A', state: 'N/A', pincode: '000000',
          vehiclenumber: vehNumber,
          vehicletype: vehType,
          ownername: vehOwner,
          emergency: vehEmergency
        })
      });

      const data = await orderRes.json();

      if (data.success) {
        closeSetupModal();
        alert(`‚úÖ Tag created for ${vehNumber}! Go to your Dashboard to view and download your QR Code.`);
        window.location.href = 'dashboard.html';
      } else {
        errBox.style.display = 'block';
        errBox.innerText = '‚ùå Error: ' + (data.error || 'Unknown error');
      }
    } catch (e) {
      errBox.style.display = 'block';
      errBox.innerText = '‚ùå Server error. Make sure your Render backend is running!';
    } finally {
      btn.innerText = 'Generate QR ‚ú®';
      btn.disabled = false;
    }
  }

  // Close modal on overlay click
  document.getElementById('setupModal').addEventListener('click', function(e) {
    if (e.target === this) closeSetupModal();
  });
</script>

</body>
</html>