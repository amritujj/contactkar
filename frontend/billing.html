<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Billing - ContactKar</title>
  <style>

    /* ══════════════ RESET & BASE ══════════════ */
    *, *::before, *::after { box-sizing:border-box; }
    body { margin:0; font-family:'Inter','Segoe UI',system-ui,sans-serif; background:#f1f5f9; color:#111827; min-height:100vh; }

    /* ══════════════ NAVBAR ══════════════ */
    .ck-nav { background:#fff; border-bottom:1px solid #e5e7eb; position:sticky; top:0; z-index:100; box-shadow:0 1px 8px rgba(0,0,0,.06); }
    .ck-nav .inner { max-width:1100px; margin:0 auto; padding:.85rem 1.5rem; display:flex; justify-content:space-between; align-items:center; }
    .ck-brand { font-size:1.35rem; font-weight:900; color:#111827; text-decoration:none; letter-spacing:-.5px; }
    .ck-brand span { color:#2563eb; }
    .ck-user { display:flex; align-items:center; gap:.9rem; }
    .ck-greeting { font-weight:600; font-size:.9rem; color:#374151; }
    .ck-logout { padding:6px 16px; border:1.5px solid #e5e7eb; border-radius:8px; background:#fff; font-weight:600; font-size:.85rem; cursor:pointer; color:#374151; transition:.2s; }
    .ck-logout:hover { background:#fef2f2; border-color:#fca5a5; color:#ef4444; }

    /* ══════════════ LAYOUT WRAPPER ══════════════ */
    .ck-wrap { max-width:1100px; margin:0 auto; padding:2rem 1.5rem 4rem; }

    /* ══════════════ TAB NAV ══════════════ */
    .tab-nav { display:flex; gap:.5rem; margin-bottom:2rem; flex-wrap:wrap; }
    .tab-nav a { padding:.55rem 1.2rem; border-radius:10px; font-weight:600; font-size:.875rem; color:#374151; border:1.5px solid #e5e7eb; background:#fff; text-decoration:none; transition:all .2s; white-space:nowrap; }
    .tab-nav a:hover { background:#eff6ff; border-color:#93c5fd; color:#2563eb; transform:translateY(-1px); }
    .tab-nav a.active { background:#2563eb; color:#fff; border-color:#2563eb; box-shadow:0 4px 14px rgba(37,99,235,.3); }

    /* ══════════════ PAGE HEADER ══════════════ */
    .pg-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; flex-wrap:wrap; gap:.8rem; }
    .pg-header h1 { font-size:1.5rem; font-weight:900; margin:0; letter-spacing:-.4px; color:#111827; }

    /* ══════════════ CARD / PANEL ══════════════ */
    .card { background:#fff; border-radius:16px; border:1px solid #e5e7eb; padding:1.6rem; margin-bottom:1.2rem; box-shadow:0 2px 10px rgba(0,0,0,.05); transition:box-shadow .25s,transform .25s; }
    .card:hover { box-shadow:0 8px 28px rgba(0,0,0,.09); transform:translateY(-2px); }
    .card-title { font-size:1rem; font-weight:800; color:#111827; margin:0 0 1rem; display:flex; align-items:center; gap:.5rem; }

    /* ══════════════ FORM ══════════════ */
    .row2 { display:grid; grid-template-columns:1fr 1fr; gap:1.2rem; }
    .fg { margin-bottom:1.1rem; }
    .fg label { display:block; font-weight:700; font-size:.82rem; color:#374151; margin-bottom:.4rem; text-transform:uppercase; letter-spacing:.4px; }
    .fc { width:100%; padding:.75rem 1rem; border:1.5px solid #d1d5db; border-radius:10px; font-size:.9rem; outline:none; font-family:inherit; color:#111827; transition:border-color .2s,box-shadow .2s; background:#fff; }
    .fc:focus { border-color:#2563eb; box-shadow:0 0 0 4px rgba(37,99,235,.1); }
    .fc::placeholder { color:#9ca3af; }
    .email-row { display:flex; justify-content:space-between; align-items:center; background:#f8fafc; border:1.5px solid #e5e7eb; border-radius:10px; padding:.7rem 1rem; }
    .email-val { font-weight:700; font-size:.9rem; color:#1d4ed8; }
    .save-msg { margin-left:12px; color:#10b981; font-weight:700; font-size:.85rem; }

    /* ══════════════ BUTTONS ══════════════ */
    .btn-primary { background:linear-gradient(135deg,#2563eb,#1d4ed8); color:#fff; border:none; border-radius:10px; padding:.75rem 1.5rem; font-weight:700; font-size:.9rem; cursor:pointer; transition:all .2s; box-shadow:0 4px 14px rgba(37,99,235,.3); font-family:inherit; }
    .btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 22px rgba(37,99,235,.4); }
    .btn-primary:active { transform:translateY(0); }
    .btn-outline { background:#fff; color:#374151; border:1.5px solid #d1d5db; border-radius:8px; padding:.5rem 1.1rem; font-weight:600; font-size:.85rem; cursor:pointer; transition:.2s; font-family:inherit; }
    .btn-outline:hover { border-color:#2563eb; color:#2563eb; background:#eff6ff; }
    .btn-danger { background:#fff; color:#ef4444; border:1.5px solid #ef4444; border-radius:10px; padding:.7rem 1.4rem; font-weight:700; font-size:.875rem; cursor:pointer; transition:.2s; font-family:inherit; }
    .btn-danger:hover { background:#fef2f2; box-shadow:0 4px 14px rgba(239,68,68,.2); }

    /* ══════════════ BADGE ══════════════ */
    .badge { display:inline-block; padding:3px 10px; border-radius:20px; font-size:11px; font-weight:800; letter-spacing:.3px; }
    .badge-blue { background:#dbeafe; color:#1d4ed8; }
    .badge-pink { background:#fce7f3; color:#be185d; }
    .badge-green{ background:#d1fae5; color:#065f46; }
    .badge-red  { background:#fee2e2; color:#991b1b; }
    .badge-amber{ background:#fef3c7; color:#92400e; }

    /* ══════════════ EMPTY STATE ══════════════ */
    .empty { border:2px dashed #d1d5db; background:#fff; border-radius:16px; padding:3rem 2rem; text-align:center; color:#6b7280; margin-bottom:1.2rem; }
    .empty .ei { font-size:3rem; margin-bottom:.8rem; }
    .empty h3 { color:#111827; font-size:1.05rem; font-weight:800; margin-bottom:.4rem; }
    .empty p { font-size:.875rem; margin-bottom:1.2rem; }

    /* ══════════════ DIVIDER ══════════════ */
    .divider { border:none; border-top:1px solid #f3f4f6; margin:1rem 0; }

    /* ══════════════ TOAST ══════════════ */
    #ck-toast { position:fixed; bottom:24px; right:20px; z-index:99999; padding:12px 20px; border-radius:12px; font-weight:700; font-size:.875rem; color:#fff; box-shadow:0 8px 28px rgba(0,0,0,.2); max-width:300px; transition:opacity .4s,transform .3s; transform:translateY(0); }

    /* ══════════════ ANIMATIONS ══════════════ */
    @keyframes fadeUp { from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
    .anim { animation:fadeUp .4s ease both; }
    .anim-d1 { animation-delay:.05s; }
    .anim-d2 { animation-delay:.1s; }
    .anim-d3 { animation-delay:.15s; }
    .anim-d4 { animation-delay:.2s; }

    /* ══════════════ RESPONSIVE ══════════════ */
    @media(max-width:640px){
      .row2 { grid-template-columns:1fr; }
      .tab-nav a { font-size:.8rem; padding:.45rem .9rem; }
      .pg-header h1 { font-size:1.25rem; }
      .ck-wrap { padding:1.2rem 1rem 3rem; }
    }

    .plan-hero { background:linear-gradient(135deg,#1d4ed8 0%,#2563eb 50%,#7c3aed 100%); border-radius:18px; padding:2rem; color:#fff; margin-bottom:1.2rem; position:relative; overflow:hidden; }
    .plan-hero::before { content:''; position:absolute; top:-30px; right:-30px; width:160px; height:160px; border-radius:50%; background:rgba(255,255,255,.08); }
    .plan-hero::after  { content:''; position:absolute; bottom:-40px; right:40px; width:100px; height:100px; border-radius:50%; background:rgba(255,255,255,.05); }
    .plan-tag { display:inline-block; background:rgba(255,255,255,.2); padding:3px 12px; border-radius:20px; font-size:11px; font-weight:800; letter-spacing:.5px; text-transform:uppercase; margin-bottom:.7rem; }
    .plan-name-big { font-size:1.6rem; font-weight:900; letter-spacing:-.5px; }
    .plan-exp { font-size:.85rem; opacity:.8; margin-top:4px; }
    .plan-actions { margin-top:1.2rem; display:flex; gap:.7rem; flex-wrap:wrap; }
    .plan-btn-white { background:#fff; color:#2563eb; border:none; border-radius:9px; padding:.6rem 1.3rem; font-weight:800; font-size:.875rem; cursor:pointer; transition:.2s; }
    .plan-btn-white:hover { box-shadow:0 4px 14px rgba(0,0,0,.2); transform:translateY(-1px); }
    .offer-banner { background:linear-gradient(135deg,#fffbeb,#fef3c7); border:2px solid #f59e0b; border-radius:14px; padding:1rem 1.3rem; margin-bottom:1.2rem; display:flex; align-items:center; gap:.8rem; flex-wrap:wrap; }
    .offer-icon { font-size:1.8rem; }
    .offer-text strong { font-size:.95rem; color:#92400e; display:block; }
    .offer-text span { font-size:.82rem; color:#78350f; }
    .qty-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin:.8rem 0 1rem; }
    .qty-card { background:#f8fafc; border:1.5px solid #e5e7eb; border-radius:12px; padding:1rem; text-align:center; transition:.2s; }
    .qty-card:focus-within { border-color:#2563eb; background:#eff6ff; }
    .qty-card label { font-weight:800; font-size:.85rem; display:block; margin-bottom:.5rem; color:#374151; text-transform:uppercase; letter-spacing:.3px; }
    .qty-card .fc { text-align:center; font-size:1.1rem; font-weight:900; border-radius:8px; padding:.55rem; }
    .addr-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:.6rem; margin-bottom:.8rem; }
    .summary-box { background:linear-gradient(135deg,#f0f9ff,#e0f2fe); border:1.5px solid #7dd3fc; border-radius:12px; padding:1.1rem 1.3rem; margin-bottom:1rem; }
    .summary-row { display:flex; justify-content:space-between; align-items:center; padding:.3rem 0; font-size:.9rem; }
    .summary-row .lbl { color:#374151; font-weight:600; }
    .summary-row .val { font-weight:800; color:#0369a1; }
    .summary-row.total .lbl { font-size:1rem; color:#111827; font-weight:900; }
    .summary-row.total .val { font-size:1.1rem; color:#2563eb; }
    .savings-pill { display:inline-block; background:#d1fae5; color:#065f46; font-size:11px; font-weight:800; padding:2px 10px; border-radius:20px; margin-left:8px; }
    @media(max-width:600px){ .qty-grid{grid-template-columns:1fr}; .addr-grid{grid-template-columns:1fr}; }
  </style>
  <script>if(localStorage.getItem('isLoggedIn')!=='true'){window.location.href='login.html';}</script>
</head>
<body>
<nav class="ck-nav">
  <div class="inner">
    <a href="index.html" class="ck-brand">Contact<span>Kar</span></a>
    <div class="ck-user">
      <span class="ck-greeting" id="user-greeting">Hi, User &#128075;</span>
      <button class="ck-logout" id="logout-btn">Logout</button>
    </div>
  </div>
</nav>
<div class="ck-wrap">
<nav class="tab-nav anim">
    <a href="dashboard.html" >&#128230; My Tags</a>
    <a href="profile.html" >&#128100; Profile</a>
    <a href="billing.html" class="active">&#128179; Billing</a>
    <a href="settings.html" >&#9881;&#65039; Settings</a>
  </nav>
  <div class="pg-header anim anim-d1"><h1>&#128179; Billing</h1></div>

  <!-- Plan card — shown if subscribed -->
  <div id="plan-hero" class="plan-hero anim anim-d2" style="display:none;">
    <div class="plan-tag">&#128081; Your Plan</div>
    <div class="plan-name-big" id="plan-name">Pro Plan</div>
    <div class="plan-exp" id="plan-exp">Valid until --</div>
    <div class="plan-actions">
      <button class="plan-btn-white" onclick="window.location.href='vehicle.html'">&#11014; Upgrade Plan</button>
    </div>
  </div>

  <!-- No plan -->
  <div id="no-plan" class="empty anim anim-d2">
    <div class="ei">&#129534;</div>
    <h3>No active subscription</h3>
    <p>You are on the free plan. Upgrade to unlock unlimited tags and more features.</p>
    <a href="vehicle.html" class="btn-primary" style="text-decoration:none;padding:.7rem 1.5rem;border-radius:10px;font-size:.875rem;display:inline-block;">&#9889; Choose a Plan</a>
  </div>

  <!-- Offer banner -->
  <div class="offer-banner anim anim-d3">
    <div class="offer-icon">&#128293;</div>
    <div class="offer-text">
      <strong>Bulk Discount on Hard Copy Tags!</strong>
      <span>Order 3+ tags &rarr; 1 free delivery &nbsp;&#183;&nbsp; Order 5+ tags &rarr; 2 free deliveries</span>
    </div>
  </div>

  <!-- Order form card -->
  <div class="card anim anim-d4">
    <div class="card-title">&#128424;&#65039; Order Hard Copy Tags</div>
    <p style="color:#6b7280;font-size:.875rem;margin:-.5rem 0 1rem;">Physical PVC sticker / locket delivered to your door. <b style="color:#111827;">Rs.149</b> per unit.</p>

    <div class="qty-grid">
      <div class="qty-card">
        <label>&#128664; Vehicle Tags</label>
        <input type="number" id="vehicleQty" min="0" value="0" class="fc" oninput="calcTotal()">
      </div>
      <div class="qty-card">
        <label>&#128062; Pet Tags</label>
        <input type="number" id="petQty" min="0" value="0" class="fc" oninput="calcTotal()">
      </div>
    </div>

    <div class="fg">
      <label>Street Address</label>
      <input type="text" id="ship-addr" placeholder="e.g. 42, MG Road, Sector 5" class="fc">
    </div>
    <div class="addr-grid">
      <div class="fg" style="margin:0;"><label>City</label><input type="text" id="ship-city" placeholder="Delhi" class="fc"></div>
      <div class="fg" style="margin:0;"><label>State</label><input type="text" id="ship-state" placeholder="Delhi" class="fc"></div>
      <div class="fg" style="margin:0;"><label>Pincode</label><input type="text" id="ship-pin" placeholder="110001" class="fc"></div>
    </div>

    <div class="summary-box" style="margin-top:1rem;">
      <div class="summary-row"><span class="lbl">Total Tags</span><span class="val" id="tot-tags">0</span></div>
      <div class="summary-row"><span class="lbl">Free Deliveries</span><span class="val" id="free-del" style="color:#10b981;">0</span></div>
      <hr class="divider"/>
      <div class="summary-row total">
        <span class="lbl">Total Amount</span>
        <span class="val">Rs.<span id="tot-cost">0</span><span id="savings-pill" class="savings-pill" style="display:none;"></span></span>
      </div>
    </div>

    <button onclick="placeOrder()" class="btn-primary" style="width:100%;justify-content:center;padding:.9rem;font-size:1rem;border-radius:12px;">
      &#128196; Proceed to Pay
    </button>
    <p style="font-size:.78rem;color:#9ca3af;text-align:center;margin-top:.7rem;">&#128274; 100% secure payment &nbsp;&#183;&nbsp; Delivery in 5-7 business days</p>
  </div>
</div>

<script>
var API='https://contactkar.onrender.com/api';

  document.getElementById('logout-btn').addEventListener('click', function() {
    localStorage.clear(); window.location.href = 'login.html';
  });
  document.getElementById('user-greeting').textContent = 'Hi, ' + (localStorage.getItem('userName') || 'User') + ' \u{1F44B}';

  function showToast(msg, color) {
    var colors = { green:'#10b981', red:'#ef4444', blue:'#2563eb', amber:'#f59e0b' };
    var el = document.getElementById('ck-toast');
    if (!el) { el = document.createElement('div'); el.id='ck-toast'; document.body.appendChild(el); }
    el.style.background = colors[color] || '#374151';
    el.style.opacity = '1'; el.style.transform = 'translateY(0)';
    el.textContent = msg;
    clearTimeout(el._t);
    el._t = setTimeout(function(){ el.style.opacity='0'; el.style.transform='translateY(10px)'; }, 3000);
  }

(function loadPlan(){
  var token=localStorage.getItem('token');if(!token)return;
  fetch(API+'/billing/plan',{headers:{Authorization:'Bearer '+token}})
    .then(function(r){return r.json();})
    .then(function(data){
      if(data.success&&data.plan&&data.plan.subscription_tier&&data.plan.subscription_tier!=='free'){
        var exp='N/A';try{exp=new Date(data.plan.subscription_expiry).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});}catch(e){}
        document.getElementById('plan-name').textContent=data.plan.subscription_tier.toUpperCase()+' Plan';
        document.getElementById('plan-exp').textContent='Valid until '+exp;
        document.getElementById('plan-hero').style.display='block';
        document.getElementById('no-plan').style.display='none';
      }
    }).catch(function(){});
})();

function calcTotal(){
  var v=parseInt(document.getElementById('vehicleQty').value)||0;
  var p=parseInt(document.getElementById('petQty').value)||0;
  var tot=v+p;var free=tot>=5?2:tot>=3?1:0;var cost=Math.max(0,tot-free)*149;
  document.getElementById('tot-tags').textContent=tot;
  document.getElementById('free-del').textContent=free;
  document.getElementById('tot-cost').textContent=cost;
  var pill=document.getElementById('savings-pill');
  if(free>0){pill.textContent='Save Rs.'+(free*149);pill.style.display='inline-block';}
  else{pill.style.display='none';}
}

function placeOrder(){
  var token=localStorage.getItem('token');
  var v=parseInt(document.getElementById('vehicleQty').value)||0;
  var p=parseInt(document.getElementById('petQty').value)||0;
  var a=document.getElementById('ship-addr').value.trim();
  var c=document.getElementById('ship-city').value.trim();
  var st=document.getElementById('ship-state').value.trim();
  var pin=document.getElementById('ship-pin').value.trim();
  if(v+p===0){showToast('Add at least 1 tag to order.','red');return;}
  if(!a||!c||!st||!pin){showToast('Please fill in your complete shipping address.','red');return;}
  fetch(API+'/orders/place',{method:'POST',headers:{'Content-Type':'application/json',Authorization:'Bearer '+token},body:JSON.stringify({vehicleQty:v,petQty:p,address:a,city:c,state:st,pincode:pin})})
    .then(function(r){return r.json();})
    .then(function(d){if(d.success){showToast('\u2705 Order placed! Delivery in 5-7 days.','green');}else{showToast('Error: '+d.error,'red');}})
    .catch(function(){showToast('Server error. Try again.','red');});
}
</script>
</body></html>